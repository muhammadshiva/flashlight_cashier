# Flavor Setup Documentation

This document outlines the complete flavor setup for the **Flashlight Kiosk** application, covering Dart, Android, and iOS configurations. The project supports three flavors: **Dev**, **Staging**, and **Production**.

## 1. Overview

Flavors allow us to build different versions of the app (e.g., for development, testing, and production) with different configurations (App ID, Name, Icon, API Base URL) from the same codebase.

| Flavor       | App Name                 | Bundle ID / Package Name | Description                  |
|--------------|--------------------------|--------------------------|------------------------------|
| **Dev**      | Flashlight Kiosk Dev     | `id.flashlight.dev`      | Development environment      |
| **Staging**  | Flashlight Kiosk Staging | `id.flashlight.qa`       | QA / Testing environment     |
| **Production**| Flashlight Kiosk         | `id.flashlight`          | Live production environment  |

---

## 2. Running the App

### Via Command Line
To run a specific flavor, use the `--flavor` flag along with the `--dart-define` to set the environment variable.

```bash
# Run Dev
flutter run --flavor dev --dart-define=FLAVOR=dev

# Run Staging
flutter run --flavor staging --dart-define=FLAVOR=staging

# Run Production
flutter run --flavor production --dart-define=FLAVOR=production
```

### Via VS Code
Launch configurations are already set up in `.vscode/launch.json`. Simply go to **Run and Debug** sidebar and select:
- `dev Debug`
- `staging Debug`
- `production Debug`

---

## 3. Dart Configuration

### `lib/flavors.dart`
This file defines the `Flavor` enum and `FlavorConfig` class. It manages Dart-side configurations like API URLs and theme colors based on the current flavor.
It detects the flavor at runtime using:
```dart
const flavor = String.fromEnvironment('FLAVOR');
```

### `lib/main.dart`
Does the initialization before running the app:
```dart
await FlavorConfig.instance.initialize();
```

---

## 4. Android Setup

### `android/app/build.gradle.kts`
We use `productFlavors` to define the different application variants.

```kotlin
android {
    // ...
    flavorDimensions += "flavor-type"
    
    productFlavors {
        create("dev") {
            dimension = "flavor-type"
            applicationId = "id.flashlight.dev"
            resValue("string", "app_name", "Flashlight Kiosk Dev")
        }
        create("staging") {
            dimension = "flavor-type"
            applicationId = "id.flashlight.qa"
            resValue("string", "app_name", "Flashlight Kiosk Staging")
        }
        create("production") {
            dimension = "flavor-type"
            applicationId = "id.flashlight"
            resValue("string", "app_name", "Flashlight Kiosk")
        }
    }
}
```

### `AndroidManifest.xml`
The `android:label` uses the variable generated by Gradle `resValue`:
```xml
<application
    android:label="@string/app_name"
    ... >
```

---

## 5. iOS Setup & Xcode Configuration

The iOS setup uses **Schemes** and **XCConfig** files to manage different bundle IDs and names.

### Schemes
We have three custom schemes in `ios/Runner.xcodeproj/xcshareddata/xcschemes/`:
1. `dev` -> Uses `Debug-dev` / `Release-dev` build configurations.
2. `staging` -> Uses `Debug-staging` / `Release-staging` build configurations.
3. `production` -> Uses `Debug-production` / `Release-production` build configurations.

### XCConfig Files (`ios/Flutter/`)
These files define the build settings for each flavor. They are crucial for Xcode to know which Bundle ID to use.

#### `Dev-Debug.xcconfig`
```xcconfig
#include? "Pods/Target Support Files/Pods-Runner/Pods-Runner.debug-dev.xcconfig"
#include "Generated.xcconfig"

PRODUCT_BUNDLE_IDENTIFIER = id.flashlight.dev
PRODUCT_NAME = Flashlight Kiosk Dev
FLAVOR = dev
ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon-Dev
```

#### `Staging-Debug.xcconfig`
```xcconfig
#include? "Pods/Target Support Files/Pods-Runner/Pods-Runner.debug-staging.xcconfig"
#include "Generated.xcconfig"

PRODUCT_BUNDLE_IDENTIFIER = id.flashlight.qa
PRODUCT_NAME = Flashlight Kiosk Staging
FLAVOR = staging
ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon-Staging
```

#### `Production-Debug.xcconfig`
```xcconfig
#include? "Pods/Target Support Files/Pods-Runner/Pods-Runner.debug-production.xcconfig"
#include "Generated.xcconfig"

PRODUCT_BUNDLE_IDENTIFIER = id.flashlight
PRODUCT_NAME = Flashlight Kiosk
FLAVOR = production
ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon
```
*Note: Release versions of these files (e.g., `Dev-Release.xcconfig`) follow the same pattern but may include different signing or compiler options if needed.*

### `Info.plist` Configuration
The `ios/Runner/Info.plist` file is dynamic, using variables defined in the `.xcconfig` files:

- **Bundle Display Name**: `$(PRODUCT_NAME)`
- **Bundle Identifier**: `$(PRODUCT_BUNDLE_IDENTIFIER)`

### How to Recreate / Verify in Xcode
If you need to manually set this up in Xcode:

1.  **Project Configurations**:
    - Go to **Runner Project** > **Info** > **Configurations**.
    - Duplicate `Debug` and `Release` configs to create:
        - `Debug-dev`, `Release-dev`
        - `Debug-staging`, `Release-staging`
        - `Debug-production`, `Release-production`
    - Expand dependencies and ensure the **Runner** target handles these new configurations.

2.  **Assign XCConfig Files**:
    - In the **Configurations** tab, assign the corresponding `.xcconfig` file from `ios/Flutter/` to each configuration (e.g., `Debug-dev` uses `Dev-Debug.xcconfig`).

3.  **Schemes**:
    - Create a new scheme for each flavor (dev, staging, production).
    - Edit Scheme > **Run** > **Build Configuration** > Select the matching config (e.g., `Debug-dev`).
    - Edit Scheme > **Archive** > **Build Configuration** > Select the matching config (e.g., `Release-dev`).

## 6. App Icons
Check the `android/app/src/main/res/` folders and `ios/Runner/Assets.xcassets/` for flavor-specific icons.
- **iOS**: `AppIcon-Dev`, `AppIcon-Staging`, `AppIcon`
- **Android**: Handled via standard source sets or `flutter_launcher_icons` / `flutter_flavorizr` generation.

---
**Note**: This setup was likely facilitated by the `flutter_flavorizr` package defined in `pubspec.yaml`.
